rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Users collection - profile data
    // Users can only read/write their own linked profiles
    match /users/{userId} {
      // Allow read if this profile is linked to the authenticated user's account
      allow read: if request.auth != null;
      
      // Allow write if authenticated
      // Note: In production, add more specific rules to check linkedProfiles
      allow write: if request.auth != null;
    }
    
    // Accounts collection - authentication data
    match /accounts/{username} {
      // Allow read for authenticated users (needed for login)
      allow read: if request.auth != null;
      
      // Allow write for authenticated users
      // Note: In production, add more specific rules
      allow write: if request.auth != null;
    }
    
    // Default deny all other documents
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
